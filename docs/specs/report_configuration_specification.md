Report Configuration Specification
==========


# Introduction
This document describes the schema for the JSON formatted Juneberry Report configuration file. This 
schema has a unique behavior when compared to other Juneberry configuration files, in that it may 
exist within its own configuration file OR be inserted into other schemas, such as model configs 
or experiment configs.

# Schema - Basic
The following schema applies to standalone ReportConfigs, or any "reports" stanzas that have been 
inserted into model configs or experiment configs.
```
{
    "reports": [
        {
            "description": <Human readable description of this report>,
            "fqcn": <fully qualified name of a class that extends the juneberry.reporting.report base class>,
            "kwargs": { <OPTIONAL kwargs to be passed (expanded) to __init__ on construction> }
        }
    ]
}
```

## Report Specific Schemas

Juneberry includes a few built-in Report classes. This section describes the schemas for each 
of the available Report types.

### Schema - ROC Report
The ROC Report type uses model evaluation output data to generate a plot with one or more RoC curves.
```
{
    "description": <Human readable description of this report>,
    "fqcn": <A string, must be equal to "juneberry.reporting.roc.ROCPlot">
    "kwargs": {
        "output_filename": <A string indicating the desired location for the output image>,
        "plot_title": <A string indicating the desired title for the Figure>,
        "legend_scaling": <A float indicating the scale factor to apply to the legend>,
        "legend_font_size": <An integer that controls the font size in the legend>,
        "line_width": <An integer that controls the line width in the figure>,
        "curve_sources": {A dictionary of key:value pairs, where each key represents a 
                          "predictions.json" file produced by a model evaluation, and the 
                          value represents which classes to generate ROC curves for from that 
                          predictions data.}
    }
}
```

### Schema - PR Report
The PR Report type will generate Precision-Recall-Confidence plots.
```
{
    "description": <Human readable description of this report>,
    "fqcn": <A string, must be equal to "juneberry.reporting.pr.PRCurve">
    "kwargs": {
        "output_dir": <A string indicating the desired output directory for storing the images 
                       generated by this report>,
        "iou": <A float indicating the iou threshold to use when calculating the curves in this report>,
        "tp_threshold": <A float indicating the true-positive threshold to use when calculating the 
                         curves in this report>,
        "stats_fqcn": <A string indicating which class to use in the Juneberry MetricsManager>,
        "curve_sources": <A dictionary of key:value pairs, where each key corresponds to a trained model 
                          and the value represents a dataset that was used to evaluate that model. A PR 
                          curve will be added to the figures for each model:dataset pair.>
    }
}
```

### Schema - Summary Report
The Summary Report type will generate a simple markdown report (and optional CSV) that summarizes 
model training and eval results, and displays or links to any training graphs and plots that were 
produced.
```
{
    "description": <Human readable description of this report>,
    "fqcn": <A string, must be equal to "juneberry.reporting.summary.Summary">
    "kwargs": {
        "md_filename": <A string indicating the desired output filename for the Summary markdown file>,
        "csv_filename": <A string indicating the desired output filename for the Summary CSV file>,
        "metrics_files": <A list of strings, where each string represents a Juneberry metrics.json 
                          file which the Report should pull Summary information from>,
        "plot_files": <A list of strings, where each string represents an image file to include in 
                       the Summary report>
    }
}
```

# Plugin Structure

The Juneberry Report schema follows the same basic pattern as other Juneberry Plugins. A class is 
specified by its Fully Qualified Class Name (FQCN) and a dictionary of keyword arguments can be 
passed in during construction. A Report Class is typically written with an init method and a 
"create_report" method.

The following code depicts a simple example of a Report Class with two arguments in the init method 
and a "create_report" method to produce the report:

```python
from juneberry.reporting.report import Report

class ExampleReport(Report):
    def __init__(self, report_output_dir: str, model_name: str, accuracy: float):
        super().__init__(output_str=report_output_dir)
        self.model_name = model_name
        self.accuracy = accuracy
        
    def create_report(self) -> None:
        print(f"Model name: {self.model_name}\n  Accuracy: {self.accuracy}")
```

The `kwargs` stanza when using this Report should have `model_name` and `accuracy` properties:

```json
{
    "kwargs": {
        "report_output_dir": "/juneberry/report_output_dir",
        "model_name": "ResNet",
        "accuracy": 0.5
    }
}
```

If the code for the Example report was stored in a file named `juneberry/reporting/example.py`, then the 
full report stanza would look something like this:

```json
{
    "description": "Report stanza illustrating how to use ExampleReport",
    "fqcn": "juneberry.reporting.example.ExampleReport",
    "kwargs": {
        "report_output_dir": "/juneberry/report_output_dir",
        "model_name": "ResNet",
        "accuracy": 0.5
    }
}
```

The previous stanza could then be inserted into the "reports" list of a report config file, a 
model config file, or an experiment config file.

# Schema Details
This section provides more information about each of the fields in the basic Report schema.

## reports
A list of reports to produce, where each Report is represented by a single Report plugin as 
described in the [Plugin Structure](#Plugin Structure) section.

### description
A human-readable description of the report.

### fqcn

### kwargs

## Schema Details - ROC Report
This section provides more information about each of the fields in the schema for a 
ROC Report stanza.

### description
A human-readable description of the report.

### fqcn

### kwargs

#### output_filename

#### plot_title
This string will be used for the title of the Figure in the ROC plot.

#### legend_scaling

#### legend_font_size

#### line_width

#### curve_sources

## Schema Details - PR Report
This section provides more information about each of the fields in the schema for a 
PR Report stanza.

### description
A human-readable description of the report.

### fqcn

### kwargs

#### output_dir

#### iou

#### tp_threshold

#### stats_fqcn

#### curve_sources

## Schema Details - Summary Report
This section provides more information about each of the fields in the schema for a 
Summary Report stanza.

### description
A human-readable description of the report.

### fqcn

### kwargs

#### md_filename

#### md_filename

#### csv_filename

#### metrics_files

#### plot_files
